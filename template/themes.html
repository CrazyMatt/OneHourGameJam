<script type='text/javascript'>
	function VoteTheme(themeID, vote, btn_id){
		$.get("api/themevote?themeID="+themeID+"&vote="+vote, function(data){
			var d = jQuery.parseJSON(data)
			
			$("#"+btn_id+"-1").removeClass("btn-danger");
			$("#"+btn_id+"-2").removeClass("btn-warning");
			$("#"+btn_id+"-3").removeClass("btn-success");
			if(vote == 1){
				$("#"+btn_id+"-"+vote).addClass("btn-danger");
			}
			if(vote == 2){
				$("#"+btn_id+"-"+vote).addClass("btn-warning");
			}
			if(vote == 3){
				$("#"+btn_id+"-"+vote).addClass("btn-success");
			}
		});
	}
</script>

<div class="col-md-10" id='themes'>
	<h3>Jam theme suggestions</h3>
	<h4>Suggest a theme</h4>
	<form method='post'>
		<div class="form-group">
			<label for="theme">Theme</label>
			<input type="text" class="form-control" id="theme" name='theme' placeholder="Theme" value="" required>
			<button type="submit" name='action' value='savenewtheme' class="btn btn-default">Save Theme</button>
		</div>
	</form>
	<h4>Suggested themes</h4>
	
	<p>
		Here you can vote on the themes you would like to appear in 1HGJ jams.
	</p>
	
	<p>
		Themes suggested above will appear in this list. Once a theme receives enough votes, it becomes considered for a jam, depending on its popuparity. Themes which don't perform as well as others regularly get removed, the threshold for removal however depends on the popularity of the other suggested themes. Old themes are also removed to make way for new ones, irrespective of their popularity as the votes for them likely no longer represent the opinion of currently active participants. Any theme that gets removed due to unpopularity or age can be sugested again at any point. 
	</p>
	
	<ul>
		<table>
			<tr>
				{{#user.isadmin}}
					<th class='themeTableCell themeTableCellCentered' style='min-width: 10px;'>Top</th>
					<th class='themeTableCell themeTableCellCentered' style='min-width: 10px;'>Keep</th>
				{{/user.isadmin}}
				<th colspan='3' class='themeTableCell themeTableCellCentered'>
					Vote
				</th>
				<th class='themeTableCell themeTableCellCentered'>
					Theme
				</th>
				{{#user.isadmin}}
					<th class='themeTableCell themeTableCellCentered'>
						Author
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						Votes
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						Popularity
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						Apathy
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						+1
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						0
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						-1
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						Days old
					</th>
					<th class='themeTableCell themeTableCellCentered'>
						Admin actions
					</th>
				{{/user.isadmin}}
			</tr>
			{{#suggested_themes}}
				{{#theme_visible}}
					{{#user.isadmin}}
						{{#is_old}}
							<tr style='background-color: #cccccc;'>
						{{/is_old}}
						{{^is_old}}
							<tr>
						{{/is_old}}
						<td class='themeTableCell themeTableCellCentered'>
							{{#top_theme}}
								<img src='{{{template_path}}}images/star.png' title='Top theme'>
							{{/top_theme}}
						</td>
						<td class='themeTableCell themeTableCellCentered' title='Theme wil be kept in voting for the next jam'>
							{{#keep_theme}}
								<img src='{{{template_path}}}images/tick.png'>
							{{/keep_theme}}
						</td>
					{{/user.isadmin}}
					{{^user.isadmin}}
						<tr>
					{{/user.isadmin}}
						<td class='themeTableCell'>
							<button id="{{{theme_button_id}}}-3" type="button" name='action' value='bantheme' class="btn btn-default {{#user_vote_for}}btn-success{{/user_vote_for}}" onclick='VoteTheme("{{{theme_id}}}", 3, "{{{theme_button_id}}}");'>+1</button>
						</td>
						<td class='themeTableCell'>
							<button id="{{{theme_button_id}}}-2" type="button" name='action' value='bantheme' class="btn btn-default {{#user_vote_neutral}}btn-warning{{/user_vote_neutral}}" onclick='VoteTheme("{{{theme_id}}}", 2, "{{{theme_button_id}}}");'>0</button>
						</td>
						<td class='themeTableCell'>
							<button id="{{{theme_button_id}}}-1" type="button" name='action' value='bantheme' class="btn btn-default {{#user_vote_against}}btn-danger{{/user_vote_against}}" onclick='VoteTheme("{{{theme_id}}}", 1, "{{{theme_button_id}}}");'>-1</button>
						</td>
						<td class='themeTableCell'>
							{{{theme}}} 
						</td>
						{{#user.isadmin}}
							<td class='themeTableCell themeTableCellCentered'>
								{{author}}
							</td>
							<td class='themeTableCell themeTableCellCentered'>
								{{votes_total}}
							</td>
							<td class='themeTableCell themeTableCellCentered' style='background-color: {{popularity_color}}'>
								{{votes_popularity}}
							</td>
							<td class='themeTableCell themeTableCellCentered' style='background-color: {{apathy_color}}'>
								{{votes_apathy}}
							</td>
							<td class='themeTableCell themeTableCellCentered'>
								{{votes_for}}
							</td>
							<td class='themeTableCell themeTableCellCentered'>
								{{votes_neutral}}
							</td>
							<td class='themeTableCell themeTableCellCentered'>
								{{votes_against}}
							</td>
							<td class='themeTableCell themeTableCellCentered'>
								{{days_ago}}
							</td>
							<td class='themeTableCell'>
								<form method='POST' style='display: inline-block;'>
									<input type='hidden' name='theme' value='{{{theme}}}'>
									<button type="submit" name='action' value='deletetheme' class="btn btn-default">Delete</button> 
									{{#banned}}
										<span style='color:red;'>BANNED</font> 
										<button type="submit" name='action' value='unbantheme' class="btn btn-default">Unban</button>
									{{/banned}}
									{{^banned}}
										<button type="submit" name='action' value='bantheme' class="btn btn-default">Ban</button>
									{{/banned}}	
								</form>
							</td>
						{{/user.isadmin}}
					</tr>
				{{/theme_visible}}
			{{/suggested_themes}}
		</table>
	</ul>
</div>